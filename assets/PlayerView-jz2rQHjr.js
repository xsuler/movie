import{an as T,p as F,j as e,q as z,r as u,ak as H,c as k,au as _}from"./vendor-93Cd5mDF.js";import{g as U,f as q,s as K,p as D,d as V,b as X,M as Y,E as v,c as C,I,a as P,P as M,B as E,L as W,e as J,u as Q,h as Z,i as ee,j as A,k as te,l as L,m as re,n as ae,o as ne,q as se,r as ie,t as ce,v as oe,w as de,x as le,y as ue,z as me,A as R,C as pe}from"./index-96eDoE_Z.js";import{a as b,I as $}from"./Icons-dXNuFknP.js";import{b as B,a as he,e as fe,l as xe}from"./react-dom-pQ6LQ2rl.js";import"./auth-PrcDRVv8.js";import"./caption-parsing-2JIV5ft1.js";import"./locales-dJRNWBBY.js";import"./hls-zqvr_1ex.js";import"./language-db-KIR7FIqY.js";function ge(t,r){return!!J().DISALLOWED_IDS.map(n=>n.split("-")).find(n=>t===n[1]&&r===n[0])}function ye(t){const{t:r}=B(),o=T(),n=F(),{error:l,value:p,loading:i}=he(async()=>{var w;const x=U();if(x)try{await q(x)}catch{throw new Error("failed-api-metadata")}else K([...D.listSources(),...D.listEmbeds()]);let c=null;try{if(!o.media)throw new Error("no media params");c=V(o.media)}catch{}if(!c)return null;if(ge(c.id,c.type))throw new Error("dmca");let f=null;try{f=await X(c.type,c.id,o.season)}catch(g){if(g.status===404)return null;throw g}if(!f)return null;let y=o.episode;if(f.meta.type===Y.SERIES){let g=f.meta.seasonData.episodes.find(s=>s.id===o.episode);g||(g=f.meta.seasonData.episodes[0]),y=g.id,(o.season!==f.meta.seasonData.id||o.episode!==g.id)&&n(`/media/${o.media}/${f.meta.seasonData.id}/${g.id}`,{replace:!0})}(w=t.onGetMeta)==null||w.call(t,f,y)},[]);return l&&l.message==="dmca"?e.jsx(v,{children:e.jsxs(C,{children:[e.jsx(I,{icon:b.DRAGON,children:"Removed"}),e.jsx(P,{children:"Media has been removed"}),e.jsx(M,{children:"This media is no longer available due to a takedown notice or copyright claim."}),e.jsx(E,{href:"/",theme:"purple",padding:"md:px-12 p-2.5",className:"mt-6",children:r("player.metadata.failed.homeButton")})]})}):l&&l.message==="failed-api-metadata"?e.jsx(v,{children:e.jsxs(C,{children:[e.jsx(I,{icon:b.WAND,children:r("player.metadata.failed.badge")}),e.jsx(P,{children:r("player.metadata.api.text")}),e.jsx(M,{children:r("player.metadata.api.title")}),e.jsx(E,{href:"/",theme:"purple",padding:"md:px-12 p-2.5",className:"mt-6",children:r("player.metadata.failed.homeButton")})]})}):l?e.jsx(v,{children:e.jsxs(C,{children:[e.jsx(I,{icon:b.WAND,children:r("player.metadata.failed.badge")}),e.jsx(P,{children:r("player.metadata.failed.title")}),e.jsx(M,{children:r("player.metadata.failed.text")}),e.jsx(E,{href:"/",theme:"purple",padding:"md:px-12 p-2.5",className:"mt-6",children:r("player.metadata.failed.homeButton")})]})}):!p&&!i?e.jsx(v,{children:e.jsxs(C,{children:[e.jsx(I,{icon:b.WAND,children:r("player.metadata.notFound.badge")}),e.jsx(P,{children:r("player.metadata.notFound.title")}),e.jsx(M,{children:r("player.metadata.notFound.text")}),e.jsx(E,{href:"/",theme:"purple",padding:"md:px-12 p-2.5",className:"mt-6",children:r("player.metadata.notFound.homeButton")})]})}):e.jsx(v,{children:e.jsx("div",{className:"flex items-center justify-center",children:e.jsx(W,{})})})}function je(t){const{t:r}=B(),o=Q("error"),n=z(),l=u.useMemo(()=>{const p=t.data;let i="";const x=Z();return i+=`URL - ${n.pathname}
`,i+=`API - ${x.length>0}

`,Object.values(p.sources).forEach(c=>{var f;i+=`${c.id}: ${c.status}
`,c.reason&&(i+=`${c.reason}
`),(f=c.error)!=null&&f.message?i+=`${c.error.name??"unknown"}: ${c.error.message}
`:c.error&&(i+=`${c.error.toString()}
`)}),i},[t,n]);return e.jsxs(v,{children:[e.jsxs(C,{children:[e.jsx(I,{icon:b.WAND,children:r("player.scraping.notFound.badge")}),e.jsx(P,{children:r("player.scraping.notFound.title")}),e.jsx(M,{children:r("player.scraping.notFound.text")}),e.jsxs("div",{className:"flex gap-3",children:[e.jsx(E,{href:"/",theme:"secondary",padding:"md:px-12 p-2.5",className:"mt-6",children:r("player.scraping.notFound.homeButton")}),e.jsx(E,{onClick:()=>o.show(),theme:"purple",padding:"md:px-12 p-2.5",className:"mt-6",children:r("player.scraping.notFound.detailsButton")})]})]}),l?e.jsx(ee,{id:o.id,onClose:()=>o.hide(),error:l}):null]})}function O(t){return t.type==="loading"}function we(t){const[r]=H(()=>({percentage:O(t)?t.percentage:0}),[t]);return e.jsxs("div",{className:k({"p-0.5 border-current border-[3px] rounded-full h-6 w-6 relative transition-colors":!0,"text-video-scraping-loading":t.type==="loading","text-video-scraping-noresult text-opacity-50":t.type==="waiting","text-video-scraping-error bg-video-scraping-error":t.type==="error","text-green-500 bg-green-500":t.type==="success","text-video-scraping-noresult bg-video-scraping-noresult":t.type==="noresult"}),children:[e.jsx(A,{animation:"fade",show:O(t),children:e.jsx("svg",{width:"100%",height:"100%",viewBox:"0 0 64 64",xmlns:"http://www.w3.org/2000/svg",className:"rounded-full -rotate-90",children:e.jsx(fe.circle,{strokeWidth:"32",strokeDasharray:_(r.percentage,o=>`${o} 100`),r:"25%",cx:"50%",cy:"50%",fill:"transparent",stroke:"currentColor",className:"transition-[strokeDasharray]"})})}),e.jsx(A,{animation:"fade",show:t.type==="error",children:e.jsx($,{className:"absolute inset-0 flex items-center justify-center text-white",icon:b.X})}),e.jsx(A,{animation:"fade",show:t.type==="success",children:e.jsx($,{className:"absolute inset-0 flex items-center text-xs justify-center text-white",icon:b.CHECKMARK})}),e.jsx(A,{animation:"fade",show:t.type==="noresult",children:e.jsx("div",{className:"absolute inset-0 flex items-center",children:e.jsx("div",{className:"h-[3px] flex-1 mx-1 rounded-full bg-background-main"})})})]})}const Se={notfound:"player.scraping.items.notFound",failure:"player.scraping.items.failure",pending:"player.scraping.items.pending"},be={failure:"error",notfound:"noresult",pending:"loading",success:"success",waiting:"waiting"};function G(t){const{t:r}=B(),o=Se[t.status],n=be[t.status];return e.jsxs("div",{className:"grid gap-4 grid-cols-[auto,1fr]","data-source-id":t.id,children:[e.jsx(we,{type:n,percentage:t.percentage??0}),e.jsxs("div",{children:[e.jsx("p",{className:n==="loading"?"text-white":"text-type-secondary",children:t.name}),e.jsx(A,{animation:"fade",show:!!o,children:e.jsx("p",{className:"text-[15px] mt-1",children:o?r(o):""})}),t.children]})]})}function ve(t){return e.jsx("div",{"data-source-id":t.id,className:"w-80 mb-6",children:e.jsx("div",{className:k({"!bg-opacity-100 py-6":t.hasChildren,"w-80 rounded-md px-6 bg-video-scraping-card bg-opacity-0":!0}),children:e.jsx(G,{...t})})})}function Ee(){const[t,r]=u.useState({}),[o,n]=u.useState([]),[l,p]=u.useState(),i=u.useRef(null),x=u.useCallback(s=>{r(s.sourceIds.map(a=>{const d=L().find(m=>m.id===a);if(!d)throw new Error("invalid source id");return{name:d.name,id:d.id,status:"waiting",percentage:0}}).reduce((a,d)=>(a[d.id]=d,a),{})),n(s.sourceIds.map(a=>({id:a,children:[]})))},[]),c=u.useCallback(s=>{const a=i.current;r(d=>(d[s]&&(d[s].status="pending"),a&&d[a]&&d[a].status==="pending"&&(d[a].status="success"),{...d})),p(s),i.current=s},[]),f=u.useCallback(s=>{r(a=>(a[s.id]&&(a[s.id].status=s.status,a[s.id].reason=s.reason,a[s.id].error=s.error,a[s.id].percentage=s.percentage),{...a}))},[]),y=u.useCallback(s=>{r(a=>(s.embeds.forEach(d=>{const h=L().find(j=>j.id===d.embedScraperId);if(!h)throw new Error("invalid source id");const m={embedId:d.embedScraperId,name:h.name,id:d.id,status:"waiting",percentage:0};a[d.id]=m}),{...a})),n(a=>{const d=a.find(h=>h.id===s.sourceId);if(!d)throw new Error("invalid source id");return d.children=s.embeds.map(h=>h.id),[...a]})},[]),w=u.useCallback(()=>{i.current=null},[]),g=u.useCallback(s=>(s&&i.current&&r(a=>i.current?(a[i.current]&&(a[i.current].status="success"),{...a}):a),s),[]);return{initEvent:x,startEvent:c,updateEvent:f,discoverEmbedsEvent:y,startScrape:w,getResult:g,sources:t,sourceOrder:o,currentSource:l}}function Ne(){const{sources:t,sourceOrder:r,currentSource:o,updateEvent:n,discoverEmbedsEvent:l,initEvent:p,getResult:i,startEvent:x,startScrape:c}=Ee();return{startScraping:u.useCallback(async y=>{const w=U();if(w){c();const s=re(w),a=await te(s.scrapeAll(y),["completed","noOutput"]);a.on("init",p),a.on("start",x),a.on("update",n),a.on("discoverEmbeds",l);const d=await a.promise();return i(d===""?null:d)}if(!D)return null;c();const g=await D.runAll({media:y,events:{init:p,start:x,update:n,discoverEmbeds:l}});return i(g)},[p,x,n,l,i,c]),sourceOrder:r,sources:t,currentSource:o}}function Ce(t,r,o,n){const[l,p]=u.useState(!1),i=u.useCallback(()=>{if(!t.current||!r.current)return;const c=[...r.current.querySelectorAll("div[data-source-id]")],f=c.findIndex(N=>N.getAttribute("data-source-id")===n),y=c[f];if(!y)return;const w=t.current.getBoundingClientRect().width,g=r.current.getBoundingClientRect().width,s=t.current.getBoundingClientRect().height,a=r.current.getBoundingClientRect().top,d=y.getBoundingClientRect().top,h=y.getBoundingClientRect().height,m=d-a,j=w/2-g/2,S=s/2-m-h/2;r.current.style.transform=`translateY(${S}px) translateX(${j}px)`,setTimeout(()=>{p(!0)},150)},[n,t,r,p]),x=u.useRef(i);return u.useEffect(()=>{i(),x.current=i},[i,o]),u.useEffect(()=>{function c(){x.current()}return window.addEventListener("resize",c),()=>{window.removeEventListener("resize",c)}},[]),l}function Ie(t){const{report:r}=ae(),{startScraping:o,sourceOrder:n,sources:l,currentSource:p}=Ne(),i=xe(),{t:x}=B(),c=u.useRef(null),f=u.useRef(null),[y,w]=u.useState(!1),g=Ce(c,f,n,p),s=u.useRef({sourceOrder:n,sources:l});u.useEffect(()=>{s.current={sourceOrder:n,sources:l}},[n,l]);const a=u.useRef(!1);u.useEffect(()=>{a.current||(a.current=!0,(async()=>{var m,j;const h=await o(t.media);i()&&((m=t.onResult)==null||m.call(t,s.current.sources,s.current.sourceOrder),r(ne(t.media,s.current.sourceOrder,s.current.sources)),(j=t.onGetStream)==null||j.call(t,h))})().catch(()=>w(!0)))},[o,t,r,i]);let d=n.findIndex(h=>h.id===p||h.children.includes(p??""));return d===-1&&(d=n.length-1),y?e.jsx(se,{iconSlot:e.jsx($,{className:"text-type-danger text-2xl",icon:b.WARNING}),children:x("player.turnstile.error")}):e.jsxs("div",{className:"h-full w-full relative dir-neutral:origin-top-left flex",ref:c,children:[!n||n.length===0?e.jsxs("div",{className:"absolute left-1/2 top-1/2 -translate-x-1/2 -translate-y-1/2 text-center flex flex-col justify-center z-0",children:[e.jsx(W,{className:"mb-8"}),e.jsx("p",{children:x("player.turnstile.verifyingHumanity")})]}):null,e.jsx("div",{className:k({"absolute transition-[transform,opacity] opacity-0 dir-neutral:left-0":!0,"!opacity-100":g}),ref:f,children:n.map(h=>{const m=l[h.id],j=Math.abs(n.findIndex(S=>S.id===h.id)-d);return e.jsx("div",{className:"transition-opacity duration-100",style:{opacity:Math.max(0,1-j*.3)},children:e.jsx(ve,{id:h.id,name:m.name,status:m.status,hasChildren:h.children.length>0,percentage:m.percentage,children:e.jsx("div",{className:k({"space-y-6 mt-8":h.children.length>0}),children:h.children.map(S=>{const N=l[S];return e.jsx(G,{id:S,name:N.name,status:N.status,percentage:N.percentage},S)})})})},h.id)})})]})}function Pe(t){const r=t??"";if(!!!r.match(/^\d+(:\d+)*$/))return null;const n=r.split(":").map(Number).reverse(),l=n[2]??0,p=Math.min(n[1]??0,59),i=Math.min(n[0]??0,p>0?59:1/0);return l*60*60+p*60+i}function Te(){const t=F(),r=T(),[o,n]=u.useState(null),[l]=ie("t"),{status:p,playMedia:i,reset:x,setScrapeNotFound:c,shouldStartFromBeginning:f,setShouldStartFromBeginning:y}=ce(),{setPlayerMeta:w,scrapeMedia:g}=oe(),s=de(),a=JSON.stringify({media:r.media,season:r.season,episode:r.episode});u.useEffect(()=>{x()},[a,x]);const d=u.useCallback(m=>{var j,S;(m==null?void 0:m.type)==="show"?t(`/media/${r.media}/${(j=m.season)==null?void 0:j.tmdbId}/${(S=m.episode)==null?void 0:S.tmdbId}`):t(`/media/${r.media}`)},[t,r]),h=u.useCallback(m=>{if(!m)return;let j;l&&(j=Pe(l)??void 0),i(le(m),ue(m.stream.captions),m.sourceId,f?0:j),y(!1)},[i,l,f,y]);return e.jsxs(me,{backUrl:s,onMetaChange:d,children:[p===R.IDLE?e.jsx(ye,{onGetMeta:w}):null,p===R.SCRAPING&&g?e.jsx(Ie,{media:g,onResult:(m,j)=>{n({sourceOrder:j,sources:m}),c()},onGetStream:h}):null,p===R.SCRAPE_NOT_FOUND&&o?e.jsx(je,{data:o}):null,p===R.PLAYBACK_ERROR?e.jsx(pe,{}):null]})}export{Te as PlayerView,Te as default};
//# sourceMappingURL=PlayerView-jz2rQHjr.js.map
